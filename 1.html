<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form  onsubmit="saveToLocalStorage(event)">
        <lable>Name : </lable>
        <input id="username" type="text" name="username" required >
        <br />
        <lable>Email : </lable> 
        <input id="email" type="email" name="emailId" required >
        <br />
        <label>Phonumber</label>
        <input id="phonenumber" type="tel"  name="phonenumber" >
        <button >Submit</button>
    </form>
    <il id="ListOfUsers"></il>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script> </script>
    <script >
        function saveToLocalStorage(event){
  event.preventDefault();
    let name = event.target.username.value;
    let email = event.target.emailId.value ;
    let phonenumber = event.target.phonenumber.value;
  
    let details = {
            name:name ,
            email:email,
            phonenumber:phonenumber
    }
   axios.post("https://crudcrud.com/api/55a83f40589a4fcfa95301ea3dd666ac/appointementData", details)
   .then((response)=>{
    showNewUserOnScreen(response.data)
    //console.log(response)
   })
.catch((err) => {

document.body.innerHTML = document.body.innerHTML+ "<h4> Something went wrong </h4>"
console.log(err)
        });
 showNewUserOnScreen(details)

}

window.addEventListener("DOMContentLoaded", ()=>{
    const data = axios.get("https://crudcrud.com/api/55a83f40589a4fcfa95301ea3dd666ac/appointmentData")
    .then((response)=>{
         console.log(response)
        for(var i=0 ;i<respnse.data.length ;i++){
            showNewUserOnScreen(response.data[i]);
        }
        })
    .catch((err) =>{
        console.log(err)
    });
   console.log(data)
})
function showNewUserOnScreen(user){
    user = {
        _id:'',
        name:'',
        email:''
    }
    document.getElementById('email').value='';
    document.getElementById('username').value ='';
    document.getElementById('phonenumber').value =''

    if(localStorage.getItem(user.email)!== null){
        removeUserFromScreen(user.email);
    }
    let parentNode = document.getElementById('ListOfUsers');
        let childHTML = `<li id=${user.email}>${user.name} - ${user.email}
           
            <button onClick=deleteUser('${user._id}')> Delete User </button>
            <button onClick=EditUser('${user._id}','${user.name}','${user.phonenumber}')> Edit User </button>
            </li>`

        parentNode.innerHTML = parentNode.innerHTML+ childHTML ; 
}
function deleteUser(userId){
    axios.delete(`https://crudcrud.com/api/55a83f40589a4fcfa95301ea3dd666ac/appointmentData/${userId}`
    ).then((response)=> {
        removeUserFromScreen(userId);
       
    }).catch((err)=>{
        console.log(err)
    })


    // localStorage.removeItem(emailId);
    // removeUserFromScreen(emailId);
  
}
function removeUserFromScreen(userId){
    let parentNode = document.getElementById('ListOfUsers')
    let childNodeToBeDeleted  = document.getElementById(userId);
    if(childNodeToBeDeleted){
    parentNode.removeChild(childNodeToBeDeleted);
    }
}

    </script>
</body>
</html>